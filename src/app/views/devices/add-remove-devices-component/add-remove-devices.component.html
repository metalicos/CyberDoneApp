<alert [type]="errorAlert.type" *ngIf="errorAlert">{{errorAlert.msg}}</alert>
<div class="d-block d-md-flex">
  <div class="card rounded-0 bg-light col-12 col-md-4 p-1 m-0 mb-auto">
    <p class="h6 text-uppercase my-2 py-0">–î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π –ø—Ä–∏—Å—Ç—Ä—ñ–π</p>
    <!-- –î–æ–¥–∞–≤–∞–Ω–Ω—è –≤–ª–∞—Å–Ω–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é -->
    <div class="card-body p-0 m-0 flex-grow-0">
      <form [formGroup]="deviceMetadataForm"
            class="justify-content-between">
        <div class="d-block d-md-flex">
          <!-- –ö–∞—Ä—Ç–∏–Ω–∫–∞ –ø—Ä–∏—Å—Ç—Ä–æ—é-->
          <div>
            <input #deviceImageInput type="file" (change)="onDeviceImageAfterFormCompletionSelected($event)" hidden>
            <button class="btn btn-transparent rounded-0 device-image-btn m-auto p-0"
                    [disabled]="uuid.invalid || name.invalid || description.invalid"
                    (click)="deviceImageInput.click()">
              <img src="{{deviceImage}}" alt="Device Image" class="device-image"
                   [class.img-blinking]="!(uuid.invalid || name.invalid || description.invalid)">
            </button>
          </div>
          <!-- –ö—ñ–Ω–µ—Ü—å –ö–∞—Ä—Ç–∏–Ω–∫–∞ –ø—Ä–∏—Å—Ç—Ä–æ—é-->
          <div class="flex-grow-1 pl-1">
            <input formControlName="name" [class.is-invalid]="name.invalid && name.touched"
                   class="form-control form-control-sm font-weight-bold rounded-0"
                   type="text" placeholder="–ù–∞–∑–≤—ñ—Ç—å –≤–∞—à –ø—Ä–∏—Å—Ç—Ä—ñ–π">
            <div class="invalid-feedback text-right" *ngIf="name.errors?.required">
              –¶–µ –ø–æ–ª–µ —î –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–º –¥–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è.
            </div>

            <input formControlName="description" [class.is-invalid]="description.invalid && description.touched"
                   class="form-control form-control-sm font-weight-bold rounded-0 mt-1"
                   type="text" placeholder="–î–æ–¥–∞–π—Ç–µ –Ω–µ–≤–µ–ª–∏–∫–∏–π –æ–ø–∏—Å">
            <div class="invalid-feedback text-right" *ngIf="description.errors?.required">
              –¶–µ –ø–æ–ª–µ —î –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–º –¥–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è.
            </div>

            <input formControlName="uuid" [class.is-invalid]="uuid.invalid && uuid.touched"
                   class="form-control form-control-sm font-weight-bold rounded-0 mt-1"
                   type="text" placeholder="–í–≤–µ–¥—ñ—Ç—å UUID –ø—Ä–∏—Å—Ç—Ä–æ—é (–∑–∞–∑–Ω–∞—á–µ–Ω–∏–π –Ω–∞ —É–ø–∞–∫–æ–≤—Ü—ñ)">
            <div class="invalid-feedback text-right" *ngIf="uuid.errors?.required">
              –¶–µ –ø–æ–ª–µ —î –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–º –¥–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è.
            </div>
            <div class="invalid-feedback text-right" *ngIf="uuid.errors?.pattern">
              –í–≤–µ–¥–µ–Ω–∏–π –≤–∞–º–∏ UUID –ø—Ä–∏—Å—Ç—Ä–æ—é –º—ñ—Å—Ç–∏—Ç—å –ø–æ–º–∏–ª–∫—É.
            </div>
            <button class="form-control form-control-sm btn btn-sm btn-dark font-weight-bold rounded-0 mt-1"
                    (click)="linkDeviceToUser()"
                    [disabled]="uuid.invalid || name.invalid || description.invalid">
              –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–π –ø—Ä–∏—Å—Ç—Ä—ñ–π
            </button>
          </div>
        </div>
      </form>
    </div>
    <!-- –ö—ñ–Ω–µ—Ü—å –î–æ–¥–∞–≤–∞–Ω–Ω—è –≤–ª–∞—Å–Ω–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é -->

    <p class="h6 text-uppercase my-2 py-0">–°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞–ø–∏—Ç –Ω–∞ –∫–µ—Ä—É–≤–∞–Ω–Ω—è —á—É–∂–∏–º –ø—Ä–∏—Å—Ç—Ä–æ—î–º</p>
    <!-- –ó–∞–ø–∏—Ç –Ω–∞ –∫–µ—Ä—É–≤–∞–Ω–Ω—è —á—É–∂–∏–º –ø—Ä–∏—Å—Ç—Ä–æ—î–º -->
    <div class="card-body p-0 m-0 flex-grow-0">
      <form [formGroup]="delegateControlRequest"
            class="justify-content-between">
        <div class="d-block d-md-flex">
          <div class="flex-grow-1 pl-1">
            <input formControlName="comment"
                   [class.is-invalid]="delegatedDeviceComment.invalid && delegatedDeviceComment.touched"
                   class="form-control form-control-sm font-weight-bold rounded-0 mt-1"
                   type="text" placeholder="–î–æ–¥–∞–π—Ç–µ –∫–æ–º–µ–Ω—Ç–∞—Ä. –ß–æ–º—É –≤–∏ –±–∞–∂–∞—î—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø—Ä–∏—Å—Ç—Ä–æ—î–º?">
            <div class="invalid-feedback text-right" *ngIf="delegatedDeviceComment.errors?.required">
              –¶–µ –ø–æ–ª–µ —î –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–º –¥–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è.
            </div>

            <input formControlName="uuid"
                   [class.is-invalid]="delegatedDeviceUuid.invalid && delegatedDeviceUuid.touched"
                   class="form-control form-control-sm font-weight-bold rounded-0 mt-1"
                   type="text" placeholder="–í–≤–µ–¥—ñ—Ç—å UUID –ø—Ä–∏—Å—Ç—Ä–æ—é –¥–ª—è —è–∫–æ–≥–æ –≤–∏–∫–æ–Ω—É—î—Ç–µ –∑–∞–ø–∏—Ç –¥–æ–∑–≤–æ–ª—É –Ω–∞ –∫–µ—Ä—É–≤–∞–Ω–Ω—è.">
            <div class="invalid-feedback text-right" *ngIf="delegatedDeviceUuid.errors?.required">
              –¶–µ –ø–æ–ª–µ —î –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–º –¥–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è.
            </div>
            <div class="invalid-feedback text-right" *ngIf="delegatedDeviceUuid.errors?.pattern">
              –í–≤–µ–¥–µ–Ω–∏–π –≤–∞–º–∏ UUID –ø—Ä–∏—Å—Ç—Ä–æ—é –º—ñ—Å—Ç–∏—Ç—å –ø–æ–º–∏–ª–∫—É.
            </div>
            <button class="form-control form-control-sm btn btn-sm btn-dark font-weight-bold rounded-0 mt-1"
                    (click)="sendDelegatedControlRequest()"
                    [disabled]="delegatedDeviceUuid.invalid || delegatedDeviceComment.invalid">
              –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –∑–∞–ø–∏—Ç –Ω–∞ –¥–æ–∑–≤—ñ–ª –∫–µ—Ä—É–≤–∞–Ω–Ω—è –ø—Ä–∏—Å—Ç—Ä–æ—î–º –π–æ–≥–æ –≤–ª–∞—Å–Ω–∏–∫—É
            </button>
          </div>
        </div>
      </form>
    </div>
    <!-- –ö—ñ–Ω–µ—Ü—å –ó–∞–ø–∏—Ç –Ω–∞ –∫–µ—Ä—É–≤–∞–Ω–Ω—è —á—É–∂–∏–º –ø—Ä–∏—Å—Ç—Ä–æ—î–º -->
  </div>

  <!-- –í–∞—à—ñ –ø—Ä–∏—Å—Ç—Ä–æ—ó -->
  <div class="card rounded-0 bg-light col-12 col-md-4 pb-1 pl-1 pr-1 pt-0 m-0">
    <p class="h6 text-uppercase my-2 py-0">–ú–æ—ó –ø—Ä–∏—Å—Ç—Ä–æ—ó</p>
    <p class="h5 text-center p-3" [hidden]="metadataList.length > 0">–ù–∞–∂–∞–ª—å, –í–∏ —â–µ –Ω–µ –¥–æ–¥–∞–ª–∏ –∂–æ–¥–Ω–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é üòü</p>
    <div class="card-body mb-0 ml-0 mr-0 mt-1 p-0" *ngFor="let meta of metadataList">
      <div class="d-flex justify-content-between align-content-center">
        <!-- –ö–∞—Ä—Ç–∏–Ω–∫–∞ –ø—Ä–∏—Å—Ç—Ä–æ—é-->
        <div class="">
          <input #deviceImageInput type="file" (change)="changeDeviceImage(meta.uuid, $event)" hidden>
          <button class="btn btn-transparent rounded-0 device-image-btn m-auto p-0"
                  (click)="deviceImageInput.click()">
            <img
              src="{{meta.deviceImage !== null && meta.deviceImage !== undefined ? imageBase64 + meta.deviceImage : 'assets/img/photo-camera-squared.svg'}}"
              alt="Device Image" class="device-image">
          </button>
        </div>
        <!--     –ö—ñ–Ω–µ—Ü—å –ö–∞—Ä—Ç–∏–Ω–∫–∞ –ø—Ä–∏—Å—Ç—Ä–æ—é-->
        <form [formGroup]="metadataFormMap.get(meta)" class="my-auto pb-0 pt-0 pl-1 pr-0 col-6 col-md-8">
          <div class="input-group">
            <input formControlName="name" #name
                   class="form-control form-control-sm font-weight-bold"
                   type="text"
                   placeholder="–ù–∞–∑–≤–∞ –ø—Ä–∏—Å—Ç—Ä–æ—é"
                   value="{{metadataFormMap.get(meta).value.name}}" disabled>
            <button class="btn btn-transparent btn-icon rounded-0" data-bs-toggle="tooltip" data-bs-placement="top"
                    title="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –Ω–∞–∑–≤—É –ø—Ä–∏—Å—Ç—Ä–æ—é"
                    (click)="name.disabled = !name.disabled;
                      changeDeviceMetadataOnDisabled(name.disabled, metadataFormMap.get(meta).value)">
              <i class="fa fa-edit text-dark"></i>
            </button>
          </div>
          <div class="input-group">
            <input formControlName="description" #description
                   class="form-control form-control-sm font-weight-bold"
                   type="text"
                   placeholder="–û–ø–∏—Å –ø—Ä–∏—Å—Ç—Ä–æ—é"
                   value="{{metadataFormMap.get(meta).value.description}}" disabled>
            <button class="btn btn-transparent btn-icon rounded-0" data-bs-toggle="tooltip" data-bs-placement="top"
                    title="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –æ–ø–∏—Å –ø—Ä–∏—Å—Ç—Ä–æ—é"
                    (click)="description.disabled = !description.disabled;
                      changeDeviceMetadataOnDisabled(description.disabled, metadataFormMap.get(meta).value)">
              <i class="fa fa-edit text-dark"></i>
            </button>
          </div>
          <div class="input-group">
            <input class="form-control form-control-sm font-weight-bold"
                   type="text"
                   placeholder="UUID –ø—Ä–∏—Å—Ç—Ä–æ—é"
                   value="{{metadataFormMap.get(meta).value.uuid}}" disabled>
            <button class="btn btn-transparent btn-icon rounded-0"
                    (click)="copyMessage(metadataFormMap.get(meta).value.uuid)"
                    data-bs-toggle="tooltip" data-bs-placement="top"
                    title="–ö–æ–ø—ñ—é–≤–∞—Ç–∏">
              <i class="fa fa-copy text-dark"></i>
            </button>
          </div>
        </form>
        <div class="my-auto">
          <button class="btn btn-transparent btn-icon rounded-0" data-bs-toggle="tooltip" data-bs-placement="top"
                  title="–í–∏–¥–∞–ª–∏—Ç–∏ –ø—Ä–∏—Å—Ç—Ä—ñ–π" (click)="deleteDeviceModal.show()">
            <i class="fa fa-trash text-dark"></i>
          </button>
        </div>
        <div bsModal #deleteDeviceModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
             aria-labelledby="myModalLabel"
             aria-hidden="true">
          <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h4 class="modal-title text-dark">–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –ø—Ä–∏—Å—Ç—Ä—ñ–π –∑ –≤–∞—à–æ–≥–æ –∞–∫–∞—É–Ω—Ç—É?</h4>
                <button type="button" class="close" (click)="deleteDeviceModal.hide();"
                        aria-label="–ó–∞–∫—Ä–∏—Ç–∏">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body btn-group">
                <button class="btn btn-sm btn-primary form-control" (click)="deleteDeviceModal.hide()">–°–∫–∞—Å—É–≤–∞—Ç–∏
                </button>
                <button class="btn btn-sm btn-danger form-control" (click)="unlinkDevice(meta.uuid)">–í–∏–¥–∞–ª–∏—Ç–∏</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <nav class="bg-grey py-1 mt-1" [hidden]="metadataList.length < 5">
      <ul class="pagination rounded-0 my-0 p-0 justify-content-center">
        <li class="page-item rounded-0">
          <a class="page-link rounded-0" href="#" aria-label="Previous">
            <span aria-hidden="true">&laquo;</span>
          </a>
        </li>
        <li class="page-item rounded-0"><a class="page-link">1</a></li>
        <li class="page-item rounded-0"><a class="page-link">2</a></li>
        <li class="page-item rounded-0 active"><a class="page-link">3</a></li>
        <li class="page-item rounded-0">
          <a class="page-link rounded-0" href="#" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
          </a>
        </li>
      </ul>
    </nav>
  </div>
  <!-- –ö—ñ–Ω–µ—Ü—å –≤–∞—à—ñ –ø—Ä–∏—Å—Ç—Ä–æ—ó -->

  <!-- –ó–∞–ø–∏—Ç–∏ –Ω–∞ –∫–µ—Ä—É–≤–∞–Ω–Ω—è —á—É–∂–∏–º–∏ –ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏ -->
  <div class="card rounded-0 bg-light col-12 col-md-4 pb-1 pl-1 pr-1 pt-0 m-0">
    <p class="h6 text-uppercase my-2 py-0">–ó–∞–ø–∏—Ç–∏ –Ω–∞ –∫–µ—Ä—É–≤–∞–Ω–Ω—è —á—É–∂–∏–º–∏ –ø—Ä–∏—Å—Ç—Ä–æ—è–º–∏</p>
    <p class="h5 text-center p-3" [hidden]="metadataList.length > 0">–ù–∞–∂–∞–ª—å, –í–∏ —â–µ –Ω–µ –¥–æ–¥–∞–ª–∏ –∂–æ–¥–Ω–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é üòü</p>
    <div class="card-body mb-0 ml-0 mr-0 mt-1 p-0" *ngFor="let meta of metadataList">
      <div class="d-flex justify-content-between align-content-center">
        <!-- –ö–∞—Ä—Ç–∏–Ω–∫–∞ –ø—Ä–∏—Å—Ç—Ä–æ—é-->
        <div class="">
          <input #deviceImageInput type="file" (change)="changeDeviceImage(meta.uuid, $event)" hidden>
          <button class="btn btn-transparent rounded-0 device-image-btn m-auto p-0"
                  (click)="deviceImageInput.click()">
            <img
              src="{{meta.deviceImage !== null && meta.deviceImage !== undefined ? imageBase64 + meta.deviceImage : 'assets/img/photo-camera-squared.svg'}}"
              alt="Device Image" class="device-image">
          </button>
        </div>
        <!--     –ö—ñ–Ω–µ—Ü—å –ö–∞—Ä—Ç–∏–Ω–∫–∞ –ø—Ä–∏—Å—Ç—Ä–æ—é-->
        <form [formGroup]="metadataFormMap.get(meta)" class="my-auto pb-0 pt-0 pl-1 pr-0 col-6 col-md-8">
          <div class="input-group">
            <input formControlName="name" #name
                   class="form-control form-control-sm font-weight-bold"
                   type="text"
                   placeholder="–ù–∞–∑–≤–∞ –ø—Ä–∏—Å—Ç—Ä–æ—é"
                   value="{{metadataFormMap.get(meta).value.name}}" disabled>
            <button class="btn btn-transparent btn-icon rounded-0" data-bs-toggle="tooltip" data-bs-placement="top"
                    title="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –Ω–∞–∑–≤—É –ø—Ä–∏—Å—Ç—Ä–æ—é"
                    (click)="name.disabled = !name.disabled;
                      changeDeviceMetadataOnDisabled(name.disabled, metadataFormMap.get(meta).value)">
              <i class="fa fa-edit text-dark"></i>
            </button>
          </div>
          <div class="input-group">
            <input formControlName="description" #description
                   class="form-control form-control-sm font-weight-bold"
                   type="text"
                   placeholder="–û–ø–∏—Å –ø—Ä–∏—Å—Ç—Ä–æ—é"
                   value="{{metadataFormMap.get(meta).value.description}}" disabled>
            <button class="btn btn-transparent btn-icon rounded-0" data-bs-toggle="tooltip" data-bs-placement="top"
                    title="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –æ–ø–∏—Å –ø—Ä–∏—Å—Ç—Ä–æ—é"
                    (click)="description.disabled = !description.disabled;
                      changeDeviceMetadataOnDisabled(description.disabled, metadataFormMap.get(meta).value)">
              <i class="fa fa-edit text-dark"></i>
            </button>
          </div>
          <div class="input-group">
            <input class="form-control form-control-sm font-weight-bold"
                   type="text"
                   placeholder="UUID –ø—Ä–∏—Å—Ç—Ä–æ—é"
                   value="{{metadataFormMap.get(meta).value.uuid}}" disabled>
            <button class="btn btn-transparent btn-icon rounded-0"
                    (click)="copyMessage(metadataFormMap.get(meta).value.uuid)"
                    data-bs-toggle="tooltip" data-bs-placement="top"
                    title="–ö–æ–ø—ñ—é–≤–∞—Ç–∏">
              <i class="fa fa-copy text-dark"></i>
            </button>
          </div>
        </form>
        <div class="my-auto">
          <button class="btn btn-transparent btn-icon rounded-0" data-bs-toggle="tooltip" data-bs-placement="top"
                  title="–í–∏–¥–∞–ª–∏—Ç–∏ –ø—Ä–∏—Å—Ç—Ä—ñ–π" (click)="deleteDeviceModal.show()">
            <i class="fa fa-trash text-dark"></i>
          </button>
        </div>
        <div bsModal #deleteDeviceModal="bs-modal" class="modal fade" tabindex="-1" role="dialog"
             aria-labelledby="myModalLabel"
             aria-hidden="true">
          <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h4 class="modal-title text-dark">–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –ø—Ä–∏—Å—Ç—Ä—ñ–π –∑ –≤–∞—à–æ–≥–æ –∞–∫–∞—É–Ω—Ç—É?</h4>
                <button type="button" class="close" (click)="deleteDeviceModal.hide();"
                        aria-label="–ó–∞–∫—Ä–∏—Ç–∏">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body btn-group">
                <button class="btn btn-sm btn-primary form-control" (click)="deleteDeviceModal.hide()">–°–∫–∞—Å—É–≤–∞—Ç–∏
                </button>
                <button class="btn btn-sm btn-danger form-control" (click)="unlinkDevice(meta.uuid)">–í–∏–¥–∞–ª–∏—Ç–∏</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <nav class="bg-grey py-1 mt-1" [hidden]="metadataList.length < 5">
      <ul class="pagination rounded-0 my-0 p-0 justify-content-center">
        <li class="page-item rounded-0">
          <a class="page-link rounded-0" href="#" aria-label="Previous">
            <span aria-hidden="true">&laquo;</span>
          </a>
        </li>
        <li class="page-item rounded-0"><a class="page-link">1</a></li>
        <li class="page-item rounded-0"><a class="page-link">2</a></li>
        <li class="page-item rounded-0 active"><a class="page-link">3</a></li>
        <li class="page-item rounded-0">
          <a class="page-link rounded-0" href="#" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
          </a>
        </li>
      </ul>
    </nav>
  </div>
</div>
